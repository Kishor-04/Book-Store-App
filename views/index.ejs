<%- include('partials/head') %>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <%- include('partials/navbar') %>
  
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <%- include('partials/messages') %>
    
    <!-- Hero Section -->
    <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
      <div class="text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
          <i class="fas fa-book-open text-blue-600"></i> Welcome to BookStore
        </h1>
        <p class="text-xl text-gray-600 mb-6">
          Discover your next favorite book from our vast collection
        </p>
        <div class="flex justify-center gap-4">
          <a href="/categories" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition">
            <i class="fas fa-th-large mr-2"></i> Browse Categories
          </a>
          <% if (!isAuthenticated) { %>
            <a href="/auth/register" class="bg-white hover:bg-gray-100 text-blue-600 font-bold py-3 px-6 rounded-lg border-2 border-blue-600 transition">
              <i class="fas fa-user-plus mr-2"></i> Join Now
            </a>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Search and Filter -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <input
            type="text"
            id="searchInput"
            placeholder="Search books by title or author..."
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>
        <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="">All Categories</option>
          <% if (typeof categories !== 'undefined') { %>
            <% categories.forEach(cat => { %>
              <option value="<%= cat._id %>"><%= cat.name %></option>
            <% }) %>
          <% } %>
        </select>
        <select id="sortSelect" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="">Sort By</option>
          <option value="title">Title</option>
          <option value="author">Author</option>
          <option value="year">Publish Year</option>
        </select>
      </div>
    </div>

    <!-- Books Grid -->
    <div class="mb-4">
      <h2 class="text-2xl font-bold text-gray-800">
        <i class="fas fa-books mr-2"></i> Latest Books
      </h2>
    </div>

    <div id="booksGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <% if (typeof books !== 'undefined' && books.length > 0) { %>
        <% books.forEach(book => { %>
          <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition duration-300 overflow-hidden">
            <div class="h-48 bg-gradient-to-br from-blue-400 to-indigo-600 flex items-center justify-center">
              <% if (book.coverImage) { %>
                <img src="<%= book.coverImage %>" alt="<%= book.title %>" class="w-full h-full object-cover">
              <% } else { %>
                <i class="fas fa-book text-white text-6xl opacity-75"></i>
              <% } %>
            </div>
            <div class="p-4">
              <h3 class="font-bold text-lg text-gray-800 mb-2 truncate" title="<%= book.title %>">
                <%= book.title %>
              </h3>
              <p class="text-gray-600 text-sm mb-2">
                <i class="fas fa-user mr-1"></i> <%= book.author %>
              </p>
              <p class="text-gray-500 text-xs mb-2">
                <i class="fas fa-calendar mr-1"></i> <%= book.publishYear %>
              </p>
              <% if (book.category) { %>
                <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mb-3">
                  <%= book.category.name %>
                </span>
              <% } %>
              
              <% if (book.price) { %>
                <div class="mt-3 pt-3 border-t border-gray-200">
                  <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-green-600">â‚¹<%= book.price.toFixed(2) %></span>
                    <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
                      <button 
                        onclick="buyBook('<%= book._id %>', '<%= book.title %>', <%= book.price %>)"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition"
                      >
                        <i class="fas fa-shopping-cart mr-1"></i> Buy Now
                      </button>
                    <% } else { %>
                      <a 
                        href="/auth/login"
                        class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition"
                      >
                        <i class="fas fa-sign-in-alt mr-1"></i> Login to Buy
                      </a>
                    <% } %>
                  </div>
                </div>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-span-full text-center py-12">
          <i class="fas fa-book-open text-gray-400 text-6xl mb-4"></i>
          <p class="text-gray-600 text-xl">No books available at the moment</p>
        </div>
      <% } %>
    </div>

    <!-- Loading state -->
    <div id="loading" class="hidden text-center py-12">
      <i class="fas fa-spinner fa-spin text-blue-600 text-4xl"></i>
      <p class="text-gray-600 mt-4">Loading books...</p>
    </div>
  </main>

  <%- include('partials/footer') %>

  <script src="/js/main.js"></script>
  <script src="/js/home.js"></script>
</body>
</html>
